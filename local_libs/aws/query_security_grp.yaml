version: v1
type: CommandLineInterface
params:
  required:
    region:
      desc: The regiion where the resource is at
      type: string
    filters:
      desc: The security grp filters
      type: object
    query:
      desc: The security grp query
      type: string
spec:
  runtime_env:
    docker:
      aws:
        name: amazon/aws-cli
        version: lastest
    nix_shell:
      aws:
        name: aws
        version: https://github.com/NixOS/nixpkgs/archive/bed08131cd29a85f19716d9351940bdc34834492.tar.gz
  test:
    - command: aws
      args:
        {{- with .Vars }}
        {{- with .region }}
        - --region {{ . }}
        {{- end }}
        - ec2 describe-security-groups
        {{- end }}
  cmds:
    - command: aws
      args:
        {{- with .Vars }}
        {{- with .region }}
        - --region {{ . }}
        {{- end }}
        - ec2 describe-security-groups
        {{- with .filters }}
        - --filters
        {{- range $key, $val := . }}
        - Name={{ $key }},Values="{{ $val }}"
        {{- end }}
        {{- end }}
        {{- with .query }}
        - --query "SecurityGroups[0].{{ . }}"
        {{- end }}
        {{- end }}
