version: v1
type: CommandLineInterface
params:
  required:
    name:
      desc: The kube configmap name
      type: string
    namespace:
      desc: The kube configmap namespace
      type: string
  optional:
    from_file:
      desc: Create kube configmap from file
      type: string
    from_env_file:
      desc: Create kube configmap from envfile
      type: string
    from_literals:
      desc: Create kube configmap from literals
      type: dict
      dict_of:
        key:
          type: string
        value:
          type: string

spec:
  runtime_env:
    nix_shell:
      kubectl:
        name: kubectl
        version: https://github.com/NixOS/nixpkgs/archive/bf972dc380f36a3bf83db052380e55f0eaa7dcb6.tar.gz
  exec:
    cmds:
      - command: kubectl
        {{- with .Vars }}
        args:
          - create configmap
          - {{ .name }}
          {{- range $key, $val := .from_literals }}
          - --from-literal={{ $key }}={{ $val }}
          {{- end }}
          {{- with .namespace }}
          - --namespace={{ . }}
          {{- end }}
          {{- with .from_file }}
          - --from-file={{ . }}
          {{- end }}
          {{- with .from_env_file }}
          - --from-env-file={{ . }}
          {{- end }}
          - --dry-run=client -o yaml
        {{- end }}
