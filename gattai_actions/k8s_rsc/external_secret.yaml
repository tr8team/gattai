version: v1
type: CommandLineInterface
params:
  required:
    name:
      desc: The content to be save if any
      type: string
    secretStoreName:
      desc: The content to be save if any
      type: string
    data:
      desc: The content to be save if any
      type: list
      list_of:
        desc: The content to be save if any
        type: object
        object_of:

spec:
  exec:
    cmds:
      - command: echo
        {{- with .Vars }}
        args:
          - |
            apiVersion: external-secrets.io/v1beta1
            kind: ExternalSecret
            metadata:
              name: {{ .name }}
            spec:
              refreshInterval: 1h
              secretStoreRef:
                name: {{ .secretStoreName }}
                kind: SecretStore
              target:
                name: secret-to-be-created
                creationPolicy: Owner
              data:
              - secretKey: secret-key-to-be-managed
                remoteRef:
                  key: provider-key
                  version: provider-key-version
                  property: provider-key-property
              dataFrom:
              - extract:
                  key: remote-key-in-the-provider
          - |
            apiVersion: external-secrets.io/v1beta1
            kind: ExternalSecret
            metadata:
              name: my-env-config
            spec:
              secretStoreRef:
                kind: SecretStore
                name: staging
              target:
                creationPolicy: Owner
              data:
              - secretKey: MY_ENV_VAR1
                remoteRef:
                  key: my-env-config
                  property: MY_ENV_VAR1
              - secretKey: MY_ENV_VAR2
                remoteRef:
                  key: my-env-config
                  property: MY_ENV_VAR2
              # OR
              dataFrom:
              - extract:
                  key: my-env-config
                  property: MY_ENV_VAR1  # optional field Label to match exactly
              # OR
              - find:
                  path: my-env-config  # optional Item Title to match exactly
                  name:
                    regexp: "^MY_ENV_VAR.*"
        {{- end }}
