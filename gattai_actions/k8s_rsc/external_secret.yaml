version: v1
type: CommandLineInterface
params:
  required:
    name:
      desc: The content to be save if any
      type: string
    secretStoreName:
      desc: The content to be save if any
      type: string
    k8sSecretName:
      desc: The content to be save if any
      type: string
  optional:
    table:
      desc: The content to be save if any
      type: dict
      dict_of:
        key:
          desc: The content to be save if any
          type: string
        value:
          desc: The content to be save if any
          type: dict
          dict_of:
            key:
              desc: The content to be save if any
              type: string
            value:
              desc: The content to be save if any
              type: string
    extract:
      desc: The content to be save if any
      type: dict
      dict_of:
        key:
          desc: The content to be save if any
          type: string
        value:
          desc: The content to be save if any
          type: string
    find:
      desc: The content to be save if any
      type: dict
      dict_of:
        key:
          desc: The content to be save if any
          type: string
        value:
          desc: The content to be save if any
          type: string
spec:
  exec:
    cmds:
      - command: echo
        {{- with .Vars }}
        args:
          - |
            apiVersion: external-secrets.io/v1beta1
            kind: ExternalSecret
            metadata:
              name: {{ .name }}
            spec:
              refreshInterval: 1h
              secretStoreRef:
                name: {{ .secretStoreName }}
                kind: SecretStore
              target:
                name: {{ .k8sSecretName }}
                creationPolicy: Owner
              data:
              {{- range $key, $val := .table }}
              - secretKey: {{ $key }}
                {{- with $val }}
                remoteRef:
                  {{ yaml . }}
                {{- end }}
              {{- end }}
              {{- with .extract }}
              dataFrom:
                - extract:
                    {{ yaml . }}
              {{- end }}
              {{- with .find }}
              dataFrom:
                - find:
                    {{ yaml . }}
              {{- end }}
        {{- end }}
